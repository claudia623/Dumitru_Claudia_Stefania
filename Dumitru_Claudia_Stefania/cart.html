<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Co»ôul de cumpƒÉrƒÉturi</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="site-layout">
    <header>
        <h1>Magazin de Plu»ôuri Cro»ôetate</h1>
        <nav>
            <div class="nav-center">
                <a href="index.html">AcasƒÉ</a>
                <a href="produse.html">Produse</a>
                <a href="contact.html">Contact</a>
            </div>
            <div class="nav-right">
                <a href="favorites.html" class="favorites-icon" title="Favorite">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21s-7.5-4.93-9.5-7.02C.8 11.6 3 7.5 6.5 7.5c1.9 0 3.2 1.2 4.5 2.6 1.3-1.4 2.6-2.6 4.5-2.6C21 7.5 23.2 11.6 21.5 13.98 19.5 16.07 12 21 12 21z"/></svg>
                    <span class="fav-badge" id="fav-badge" style="display:none">0</span>
                </a>
                <a href="cart.html" class="cart-icon" title="Co»ô de cumpƒÉrƒÉturi">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M7 20a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm10 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zM7.16 16h9.68c.8 0 1.5-.48 1.8-1.22l3.24-7.24A1 1 0 0 0 21 6H6.21l-.94-2.36A1 1 0 0 0 4.34 2H1v2h2.34l3.6 9.03-1.35 2.44C4.52 16.37 5.48 18 7 18h12v-2H7.42a.25.25 0 0 1-.22-.13l.96-1.87z"/></svg>
                    <span class="cart-badge" id="cart-badge" style="display:none">0</span>
                </a>
                <a href="login.html" class="login-link">Login</a>
            </div>
        </nav>
    </header>
    <script src="site-ui.js"></script>
    <script src="favorites.js"></script>
    <main>
        <div class="cart-wrapper">
            <section class="cart-card" id="cart-content">
                <!-- Cart content will be rendered here by JS -->
                <h2 style="color:#b97a7a;text-align:center">Co»ôul tƒÉu de cumpƒÉrƒÉturi</h2>
                <div id="cart-inner" style="margin-top:12px;">
                    <p class="cart-empty" style="color:#7d4c4c;text-align:center;padding:20px;">Se √ÆncarcƒÉ...</p>
                </div>
            </section>
        </div>
    </main>
    <script src="cart.js"></script>
    <script src="site-ui.js"></script>
    <script>
        function getCart(){
            return (window.cartAPI && window.cartAPI.getCart) ? window.cartAPI.getCart() : JSON.parse(localStorage.getItem('cart')||'[]');
        }
        function renderCart(){
            var container = document.getElementById('cart-inner');
            var cart = getCart() || [];
            container.innerHTML = '';
            if(!cart.length){
                container.innerHTML = '<p class="cart-empty" style="color:#7d4c4c;text-align:center;padding:20px;">Momentan co»ôul este gol.</p>';
                return;
            }
            var table = document.createElement('table'); table.className = 'cart-list';
            var thead = document.createElement('thead'); thead.innerHTML = '<tr><th>Produs</th><th>Cantitate</th><th>Pre»õ/buc</th><th>Subtotal</th><th></th></tr>';
            table.appendChild(thead);
            var tbody = document.createElement('tbody');
            var total = 0;
            cart.forEach(function(it){
                var tr = document.createElement('tr');
                var titleTd = document.createElement('td');
                titleTd.innerHTML = '<div style="display:flex;gap:8px;align-items:center"><img src="'+(it.image||'')+'" style="width:48px;height:48px;object-fit:cover;border-radius:6px"> <div><strong>'+ (it.title || '') +'</strong></div></div>';

                // Quantity controls
                var qtyTd = document.createElement('td');
                qtyTd.style.display = 'flex'; qtyTd.style.alignItems = 'center'; qtyTd.style.gap = '8px';
                var dec = document.createElement('button'); dec.className = 'btn ghost qty-decrease'; dec.setAttribute('data-id', it.id); dec.textContent = '-'; dec.setAttribute('aria-label','Scade cantitatea');
                var qtyVal = document.createElement('span'); qtyVal.className = 'qty-value'; qtyVal.setAttribute('data-id', it.id); qtyVal.textContent = it.qty || 1;
                var inc = document.createElement('button'); inc.className = 'btn qty-increase'; inc.setAttribute('data-id', it.id); inc.textContent = '+'; inc.setAttribute('aria-label','Cre»ôte cantitatea');
                // disable decrease when qty is 1 (user must use remove button to delete)
                try{ if(Number(it.qty||1) <= 1) dec.disabled = true; }catch(e){}
                qtyTd.appendChild(dec); qtyTd.appendChild(qtyVal); qtyTd.appendChild(inc);

                var priceTd = document.createElement('td'); priceTd.textContent = (it.price||0) + ' lei';
                var lineTotal = (Number(it.price||0) * Number(it.qty||1)); total += lineTotal;
                var totalTd = document.createElement('td'); totalTd.className = 'line-total'; totalTd.setAttribute('data-id', it.id); totalTd.textContent = lineTotal + ' lei';
                var remTd = document.createElement('td'); remTd.innerHTML = '<button class="btn ghost remove-item" data-id="'+it.id+'" title="EliminƒÉ"><span aria-hidden="true">üóëÔ∏è</span></button>';
                tr.appendChild(titleTd); tr.appendChild(qtyTd); tr.appendChild(priceTd); tr.appendChild(totalTd); tr.appendChild(remTd);
                tbody.appendChild(tr);
            });
            table.appendChild(tbody);
            var footer = document.createElement('div'); footer.style.marginTop='12px'; footer.innerHTML = '<div style="text-align:right;font-weight:700">Total: <span id="cart-total">'+ total +'</span> lei</div><div style="margin-top:8px;text-align:right"><button class="btn" id="checkout-btn">FinalizeazƒÉ comanda</button> <button class="btn ghost" id="clear-cart">Gole»ôte co»ô</button></div>';
            container.appendChild(table); container.appendChild(footer);

            // attach remove handlers with fade-out animation
            container.querySelectorAll('.remove-item').forEach(function(b){
                b.addEventListener('click', function(){
                    var id = b.dataset.id;
                    var row = b.closest('tr');
                    if(row){ row.classList.add('fade-out'); }
                    setTimeout(function(){
                        if(window.cartAPI && window.cartAPI.removeItem) window.cartAPI.removeItem(id);
                        else { var c=JSON.parse(localStorage.getItem('cart')||'[]'); c=c.filter(function(x){return x.id!==id}); localStorage.setItem('cart',JSON.stringify(c)); window.dispatchEvent(new CustomEvent('cartUpdated',{detail:{cart:c}})); }
                    }, 320);
                });
            });

            // Quantity +/- handlers
            function changeQty(id, delta){
                if(!id) return;
                if(window.cartAPI && window.cartAPI.getCart && window.cartAPI.updateQty){
                    var current = (window.cartAPI.getCart()||[]).find(function(x){return x.id===id});
                    var currQty = current ? Number(current.qty||1) : 1;
                    var newQty = Math.max(1, currQty + delta); // never go below 1
                    if(newQty === currQty) return; // no-op
                    window.cartAPI.updateQty(id, newQty);
                } else {
                    var c = JSON.parse(localStorage.getItem('cart')||'[]');
                    var it = c.find(function(x){return x.id===id});
                    if(!it) return;
                    var currQty = Number(it.qty||1);
                    var newQty = Math.max(1, currQty + delta);
                    if(newQty === currQty) return;
                    it.qty = newQty;
                    localStorage.setItem('cart', JSON.stringify(c));
                    window.dispatchEvent(new CustomEvent('cartUpdated',{detail:{cart:c}}));
                }
            }

            container.querySelectorAll('.qty-increase').forEach(function(b){ b.addEventListener('click', function(){ changeQty(b.dataset.id, 1); }); });
            container.querySelectorAll('.qty-decrease').forEach(function(b){ b.addEventListener('click', function(){ changeQty(b.dataset.id, -1); }); });

            var clearBtn = document.getElementById('clear-cart'); if(clearBtn) clearBtn.addEventListener('click', function(){ if(window.cartAPI && window.cartAPI.clearCart) window.cartAPI.clearCart(); else { localStorage.removeItem('cart'); window.dispatchEvent(new CustomEvent('cartUpdated',{detail:{cart:[]}})); } });
        }
        document.addEventListener('DOMContentLoaded', function(){ renderCart(); window.addEventListener('cartUpdated', function(){ renderCart(); }); });
    </script>
    <footer class="site-footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-about">
                    <h4>Despre noi</h4>
                    <p>Plu»ôuri cro»ôetate manual, create cu grijƒÉ »ôi aten»õie la detalii. Cadouri perfecte pentru toate v√¢rstele.</p>
                </div>
                <div class="footer-contact">
                    <h4>Contact</h4>
                    <p>Email: <a href="mailto:plusuricrosetate@email.com">plusuricrosetate@email.com</a></p>
                    <p>Telefon: 0722 123 456</p>
                </div>
                <div class="footer-links">
                    <h4>Link-uri</h4>
                    <p><a href="produse.html">Produse</a></p>
                    <p><a href="contact.html">Formular contact</a></p>
                    <p><a href="cart.html">Co»ô</a></p>
                </div>
            </div>
            <div class="footer-bottom text-center muted">&copy; 2025 Magazin Plu»ôuri Cro»ôetate. Toate drepturile rezervate.</div>
        </div>
    </footer>
</body>
</html>
