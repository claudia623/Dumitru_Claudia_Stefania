<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magazin Plușuri Croșetate - Login</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="site-layout">
    <header>
        <h1>Magazin de Plușuri Croșetate</h1>
    </header>
    <nav>
        <div class="nav-center">
            <a href="index.html">Acasă</a>
            <a href="produse.html">Produse</a>
            <a href="contact.html">Contact</a>
        </div>
        <div class="nav-right">
            <a href="cart.html" class="cart-icon" title="Coș de cumpărături">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M7 20a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm10 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zM7.16 16h9.68c.8 0 1.5-.48 1.8-1.22l3.24-7.24A1 1 0 0 0 21 6H6.21l-.94-2.36A1 1 0 0 0 4.34 2H1v2h2.34l3.6 9.03-1.35 2.44C4.52 16.37 5.48 18 7 18h12v-2H7.42a.25.25 0 0 1-.22-.13l.96-1.87z"/></svg>
                <span class="cart-badge" id="cart-badge" style="display:none">0</span>
            </a>
            <a href="login.html" class="login-link">Login</a>
        </div>
    </nav>
    <main class="container">
        <section class="login-section">
            <h2>Autentificare</h2>
            <form class="login-form">
                <label for="username">Utilizator</label>
                <input type="text" id="username" name="username" placeholder="Nume utilizator" required>
                <label for="password">Parolă</label>
                <input type="password" id="password" name="password" placeholder="Parola" required>
                <button type="submit">Login</button>
                <button type="button" class="guest-btn" onclick="window.location.href='index.html'">Continuă ca Guest</button>
            </form>
            <div class="register-link">
                <p>Nu ai cont? <a href="#" onclick="showRegister();return false;">Înregistrează-te aici</a></p>
            </div>
        </section>
        <section class="register-section" id="register-section" style="display:none; margin-top:30px;">
            <h2>Înregistrare</h2>
            <form class="register-form">
                <label for="reg-username">Nume utilizator</label>
                <input type="text" id="reg-username" name="reg-username" placeholder="Nume utilizator" required>
                <label for="reg-email">Email</label>
                <input type="email" id="reg-email" name="reg-email" placeholder="Email" required>
                <label for="reg-password">Parolă</label>
                <input type="password" id="reg-password" name="reg-password" placeholder="Parola" required>
                <button type="submit">Creează cont</button>
            </form>
            <div class="register-link" style="margin-top:20px;">
                <p>Ai deja cont? <a href="#" onclick="showLogin();return false;">Autentifică-te aici</a></p>
            </div>
        </section>
    </main>
    <aside>
        <div class="newsletter-box" style="padding:15px; background:rgba(212,99,122,0.05); border-radius:10px; margin-top:20px;">
            <h4 style="margin-top:0">Newsletter</h4>
            <p style="font-size:0.9rem">Abonează-te pentru a afla când adaug plușuri noi!</p>
            <input type="email" placeholder="email@exemplu.com" style="margin-bottom:8px">
            <button class="add-btn" style="width:100%">Abonează-te</button>
        </div>
    </aside>
    <script defer src="auth-api.js"></script>
    <script>
        function showRegister() {
            document.querySelector('.login-section').style.display = 'none';
            document.getElementById('register-section').style.display = 'block';
        }
        function showLogin() {
            document.querySelector('.login-section').style.display = 'block';
            document.getElementById('register-section').style.display = 'none';
        }
        
        function toast(msg){ 
            var container = document.getElementById('site-toast-center');
            if(!container){
                container = document.createElement('div');
                container.id = 'site-toast-center';
                container.className = 'site-toast-center';
                document.body.appendChild(container);
            }
            var t = document.createElement('div');
            t.className = 'toast toast--enter toast--center';
            t.textContent = msg;
            container.appendChild(t);
            void t.offsetWidth;
            t.classList.remove('toast--enter');
            t.classList.add('toast--visible');
            setTimeout(function(){
                t.classList.remove('toast--visible');
                t.classList.add('toast--leave');
                setTimeout(function(){ try{ container.removeChild(t); }catch(e){} }, 400);
            }, 2200);
        }
        
        document.addEventListener('DOMContentLoaded', function(){
            // If already logged in, show message
            try{
                var u = window.auth && window.auth.getCurrentUser && window.auth.getCurrentUser();
                if(u){ toast('Ești deja autentificat ca ' + u.username); }
            }catch(e){}
            
            var loginForm = document.querySelector('.login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    var user = document.getElementById('username').value;
                    var pass = document.getElementById('password').value;
                    if(!window.auth || !window.auth.login){ return; }
                    window.auth.login(user, pass).then(function(){
                        toast('Bine ai venit!');
                        var pending = null;
                        try{ pending = JSON.parse(localStorage.getItem('pendingFavorite')||'null'); }catch(e){}
                        if(pending && pending.productId){
                          if(window.favoritesAPI && window.favoritesAPI.add) window.favoritesAPI.add(pending.productId);
                          localStorage.removeItem('pendingFavorite');
                          window.location.href = pending.returnURL || 'index.html';
                        } else {
                          window.location.href = 'index.html';
                        }
                    }).catch(function(err){ toast(err && err.message ? err.message : 'Eroare la autentificare'); });
                });
            }
            
            var registerForm = document.querySelector('.register-form');
            if (registerForm) {
                registerForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    var ru = document.getElementById('reg-username').value;
                    var re = document.getElementById('reg-email').value;
                    var rp = document.getElementById('reg-password').value;
                    if(!window.auth || !window.auth.register){ return; }
                    window.auth.register(ru, re, rp).then(function(){
                        toast('Cont creat cu succes!');
                        var pending = null;
                        try{ pending = JSON.parse(localStorage.getItem('pendingFavorite')||'null'); }catch(e){}
                        if(pending && pending.productId){
                          if(window.favoritesAPI && window.favoritesAPI.add) window.favoritesAPI.add(pending.productId);
                          localStorage.removeItem('pendingFavorite');
                          window.location.href = pending.returnURL || 'index.html';
                        } else {
                          window.location.href = 'index.html';
                        }
                    }).catch(function(err){ toast(err && err.message ? err.message : 'Eroare la înregistrare'); });
                });
            }
        });
    </script>
    <footer class="site-footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-about">
                    <h4>Despre noi</h4>
                    <p>Plușuri croșetate manual, create cu grijă și atenție la detalii. Cadouri perfecte pentru toate vârstele.</p>
                </div>
                <div class="footer-contact">
                    <h4>Contact</h4>
                    <p>Email: <a href="mailto:plusuricrosetate@email.com">plusuricrosetate@email.com</a></p>
                    <p>Telefon: 0722 123 456</p>
                </div>
                <div class="footer-links">
                    <h4>Link-uri</h4>
                    <p><a href="produse.html">Produse</a></p>
                    <p><a href="contact.html">Formular contact</a></p>
                    <p><a href="cart.html">Coș</a></p>
                </div>
            </div>
            <div class="footer-bottom text-center muted">&copy; 2025 Magazin Plușuri Croșetate. Toate drepturile rezervate.</div>
        </div>
    </footer>
    <button id="back-to-top" onclick="window.scrollTo({top:0, behavior:'smooth'})" title="Înapoi sus">↑</button>
</body>
</html>
